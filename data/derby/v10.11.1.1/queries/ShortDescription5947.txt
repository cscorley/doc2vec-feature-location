Factor out common code from generated classes