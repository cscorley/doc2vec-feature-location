Improve error handling when restricting file permissions